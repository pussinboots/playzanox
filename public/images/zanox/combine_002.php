var DWIN={};(function($d,$){$d.imagesLocation=window.location.protocol+'//images.affiliatewindow.com/';$d.sessionToken='';$d.showInfo=function(message,title,callback){$.alerts.dialogClass='info';$.alerts.alert(message,title,callback)};$d.showPrompt=function(message,value,title,callback){$.alerts.dialogClass='question';$.alerts.prompt(message,value,title,callback)};$d.showConfirm=function(message,title,callback){$.alerts.dialogClass='warning';$.alerts.confirm(message,title,callback)};$d.confirmOnUnsavedChanges=function(event,message){event.preventDefault();message=(undefined===message)?DWIN.i18n.t('You have unsaved changes, are you sure you want to leave?'):message;var link=$(event.currentTarget).attr('href');if(link.indexOf('javascript:')===0){return false}DWIN.showConfirm(message,DWIN.i18n.t('Confirm'),function(result){if(result){window.location=link}});return false};$d.showError=function(message,title,callback){$.alerts.dialogClass='error';message=(undefined===message)?DWIN.i18n.t('Error occurred, please reload the page and try again.'):message;$.alerts.alert(message,title,callback)};$d.showWarning=function(message,title,callback){$.alerts.dialogClass='warning';$.alerts.alert(message,title,callback)};$d.showSuccess=function(message,title,callback){$.alerts.dialogClass='success';$.alerts.alert(message,title,callback)};$d.showNonCompliantBrowserMessage=function(){if(jQuery.browser.msie&&jQuery.browser.version<7){var msg='<strong>'+DWIN.i18n.t('You are using an outdated browser.')+'</strong> '+DWIN.i18n.t('We suggest you <a>upgrade to a safer and more compatible browser</a>',['href="browser/upgrade"']);$('<div id="non_compliant_browser"><p style="position: relative;">'+msg+'</p></div>').prependTo('#container')}};$d.showSubSessionExpiredMessage=function(callback){DWIN.showError(DWIN.i18n.t('The temporary data associated with your request has expired. Please re-visit the account and try again.'),DWIN.i18n.t('Temporary Data Expired'),callback)};$d.debounce=function(func,threshold){var timeout;return function debounced(){var obj=this,args=arguments;function delayed(){func.apply(obj,args);timeout=null}if(timeout){clearTimeout(timeout)}timeout=setTimeout(delayed,threshold||100)}};$d.image=function(imageName){return this.imagesLocation+imageName};$d.externalLinks=function(id){var selector=id?'#'+id+' a':"a[rel='external']";$(selector).attr('target','_blank').attr('rel','nofollow')};$d.setSessionToken=function(token){jQuery.ajaxSetup({'beforeSend':function(xhr){xhr.setRequestHeader('sessionToken',token)}});DWIN.sessionToken=token};$d.getSessionToken=function(){return DWIN.sessionToken}})(DWIN,jQuery);DWIN.showNonCompliantBrowserMessage();jQuery(document).ajaxError(function(event,request,settings){if(request.status==409){}else if(request.status==401){DWIN.showError(DWIN.i18n.t('Your session has expired. Please click ok to re-login.'),DWIN.i18n.t('Expired Session'),function(){location.reload()})}else if(request.status>0&&settings.error===undefined){try{var json=jQuery.parseJSON(request.responseText);DWIN.showError(json.message,json.title)}catch(e){DWIN.showError()}}});jQuery('a.modal').live('click',function(event){event.preventDefault();jQuery.modal(this.href)});jQuery('form').bind('submit',function(){if(jQuery(this).data('submitted')){return false}jQuery(this).data('submitted',true)});(function($i,$){var config={translateUrl:'/translate/xhr-lang-file',defaultLanguage:'en_GB',translate:false};var dict={};function _loadDictionary(locale){if(!_localeIsSupported(locale)){locale=config.defaultLanguage}var translateUrl=config.translateUrl;if(typeof i18n!=='undefined'){translateUrl=i18n.dictionaryUrl}$.ajax({url:translateUrl,data:{locale:locale},async:false,success:function(response){dict[locale]=response},dataType:'json'})}function _localeIsLoaded(locale){if(dict[locale]){return true}return false}function _localeIsSupported(locale){if($.inArray(locale,i18n.supportedLocales)>-1){return true}return false}function _paramReplace(message,opts){$.each(opts,function(key,value){message.replace(/%([0-9])+\$(b|c|d|e|E|u|f|F|g|G|o|s|x|X)/g,function(match,partMatch){message=message.replace(match,opts[(partMatch-1)])})});return message}function _getMessageId(messageId){if(!_localeIsLoaded(i18n.locale)){_loadDictionary(i18n.locale)}if(messageId.substring(0,3)!=='js.'){messageId='js.'+messageId}return dict[i18n.locale][messageId]||messageId}function _isInitialized(){if(config.translate){return true}if(typeof i18n!=='undefined'){config.translate=true;return true}return false}$i.t=function(messageId,opts){if(!_isInitialized()){return messageId}var string=_getMessageId(messageId);if(opts!==undefined){string=_paramReplace(string,opts)}return string};$i.getLocale=function(){if(typeof i18n!=='undefined'){return i18n.locale}return config.defaultLanguage};$i.plural=function(messageId,pluralNum,opts){var plurals=_getMessageId(messageId);if(typeof plurals==='string'){return $i.t(messageId,opts)}if(plurals.length<2){return $i.t(plurals[0],opts)}var useIndex=pluralNum>1?1:0;var string=plurals[useIndex];if(opts!==undefined){string=_paramReplace(string,opts)}return string};$i.setConfig=function(options){if(options.hasOwnProperty('supportedLocales')){if($.inArray(config.defaultLanguage,options.supportedLocales)===-1){options.supportedLocales.push(config.defaultLanguage)}}$.extend(config,options)};$i.getLanguage=function(){return this.getLocale().substring(0,2)};$i.getIntlDialCode=function(){var countryCodes={'en_US':'+1','de_DE':'+49','nl_NL':'+31','fr_FR':'+33','es_ES':'+34','it_IT':'+39','pt_BR':'+55','pl_PL':'+48','sv_SE':'+46','tr_TR':'+90'};if(countryCodes[this.getLocale()]!==undefined){return countryCodes[this.getLocale()]}else{return'+44'}}})(DWIN.i18n={},jQuery);(function($){var _currentWindow=null;$.modal=function(url,params,options){var defaults={id:'modalGeneric'};options=$.extend({},defaults,options);if(options.id===defaults.id){$('#'+options.id).remove()}if(!$('#'+options.id).length){$.blockUI();$.get(url,params,function(html){$('body').prepend('<div id="'+options.id+'" style="display:none">'+html+'</div>');if(options.width){$('#'+options.id).width(options.width)}$('#'+options.id).modal(options);$.unblockUI()}).error(function(){$.unblockUI()})}else{$('#'+options.id).modal()}};$.fn.modal=function(options){var defaults={adjustTableWidths:false,attachSaveAndCancel:false,attachDismiss:true,callback:function(){},onSuccess:function(){},resizeElement:false,resizeElementHeight:0.7,removeFromDom:false,beforeClose:function(){},onSave:function(){}};$.fn.modal.options=$.extend({},defaults,options);_currentWindow=this;if($.fn.modal.options.attachDismiss&&!$(this).find('.modal_dismiss').length){$(this).prepend('<img class="modal_dismiss pointer"  src="'+DWIN.image('/common/icons/16x16/cross.png')+'" />')}if($.fn.modal.options.attachSaveAndCancel&&!$(this).find('.boxFooter').length){$(this).append('<div class="boxFooter">'+'<div class="buttonGreenSmall modal_save"><span>'+DWIN.i18n.t('js.Save')+'</span></div><a class="modal_cancel red cancel" href="">'+DWIN.i18n.t('js.Cancel')+'</a>'+'</div>');$(this).find('.modal_save').click(function(){if($(this).hasClass('buttonDisabled')){return}$.fn.modal.options.onSave()})}if(this.css('display')=='none'){$.fn.modal.options.callback();$(this).addClass('modalWindow');modalCenterAndResize();$(this).css({'display':'block'});if($.fn.modal.options.adjustTableWidths){var tOptions=options.adjustTableWidths;modalAdjustTableWidths(tOptions.headId,tOptions.contentId,tOptions.widths)}if(!$('#modalBackground').length){$('<div>').attr('id','modalBackground').css({'height':$(window).height(),'opacity':0.5,'display':'block'}).insertBefore(this);$('#modalBackground').click(function(){$.modalClose()})}$(document).keypress(function(e){if(e.keyCode==27){$.modalClose()}});$(window).resize(modalCenterAndResize)}this.find('.modal_cancel, .modal_dismiss').click($.modalClose);$.fn.modal.options.onSuccess()};$.modalClose=function(){if($.isFunction($.fn.modal.options.beforeClose())){$.fn.modal.options.beforeClose()}$('#modalBackground').remove();$(window).unbind('resize');_currentWindow.hide();if($.fn.modal.options.removeFromDom){_currentWindow.remove()}return false};function modalCenterAndResize(){var o=$.fn.modal.options;if(o.resizeElement!='false'){$(o.resizeElement).css('height',($(window).height()*o.resizeElementHeight)+'px')}$('#modalBackground').css('height',$(window).height());var topPos=$(window).height()/2-_currentWindow.height()/2;var leftPos=$(window).width()/2-_currentWindow.width()/2;_currentWindow.css({'top':((topPos>50?topPos:50)+$(window).scrollTop()),'left':(leftPos>50?leftPos:50)})}function modalAdjustTableWidths(headId,contentId,widths){$(widths).each(function(i){if(this>0){$('#'+headId+' tr th:nth-child('+(i+1)+')').css('width',parseInt(this,10))}});widths={};$('#'+headId+' tr th').each(function(i){$(this).css({'width':$(this).width()});widths[i]=$(this).width()});$('#'+contentId).css('width',$('#'+contentId).width());$('#'+contentId+' tr:first td').each(function(i){$(this).css('width',widths[i]+(2==i&&!jQuery.browser.msie?5:20))})}})(jQuery);(function($){var _options={};$.modalForm=function(url,params,options){var defaults={form:'',onSuccess:function(){},onSave:function(){},onSaveSuccess:function(){},onSaveError:function(){},blockUI:true,blocked:false,saveButtonClass:'modal_save'};_options=$.extend({},defaults,options);var modalOptions=$.extend({},options,{onSuccess:function(){$('.'+_options.saveButtonClass).click(modalSave);_options.onSuccess()}});$.modal(url,params,modalOptions)};function modalSave(evt){if($(this).data("disabled"))return;_block();var f=$(_options.form);if(!f.length){$.ajax({type:'POST',dataType:'json',url:_options.url,success:modalSuccess,complete:modalComplete});_options.onSave()}else{f.attr('action',_options.url);f.ajaxSubmit({beforeSend:_options.onSave(),success:function(data){if(!data.saved){modalError(data)}else{_options.onSave();modalSuccess(data)}},complete:modalComplete})}}function modalSuccess(data){_options.onSaveSuccess(data);$.modalClose()}function modalError(data){if(!data.error){$('#'+_options.id).html(data)}else{DWIN.showError(data.error)}_options.onSaveError(data)}function modalComplete(){_unblock()}function _block(){if(_options.blockUI){if(_options.blocked){return}_options.blocked=true;$.blockUI()}}function _unblock(){if(_options.blockUI){$.unblockUI();_options.blocked=false}}})(jQuery);(function($){if(/1\.(0|1|2)\.(0|1|2)/.test($.fn.jquery)||/^1.1/.test($.fn.jquery)){alert(DWIN.i18n.t('blockUI requires jQuery v1.2.3 or later!  You are using v',[$.fn.jquery]));return}$.fn._fadeIn=$.fn.fadeIn;var noOp=function(){};var mode=document.documentMode||0;var setExpr=$.browser.msie&&(($.browser.version<8&&!mode)||mode<8);var ie6=$.browser.msie&&/MSIE 6.0/.test(navigator.userAgent)&&!mode;$.blockUI=function(opts){install(window,opts)};$.unblockUI=function(opts){remove(window,opts)};$.growlUI=function(title,message,timeout,onClose){var $m=$('<div class="growlUI"></div>');if(title)$m.append('<h1>'+title+'</h1>');if(message)$m.append('<h2>'+message+'</h2>');if(timeout==undefined)timeout=3000;$.blockUI({message:$m,fadeIn:700,fadeOut:1000,centerY:false,timeout:timeout,showOverlay:false,onUnblock:onClose,css:$.blockUI.defaults.growlCSS})};$.fn.block=function(opts){return this.unblock({fadeOut:0}).each(function(){if($.css(this,'position')=='static')this.style.position='relative';if($.browser.msie)this.style.zoom=1;install(this,opts)})};$.fn.unblock=function(opts){return this.each(function(){remove(this,opts)})};$.blockUI.version=2.31;$.blockUI.defaults={message:'',title:null,draggable:true,theme:false,css:{padding:0,margin:0,width:'30%',top:'40%',left:'35%',textAlign:'center',cursor:'wait'},themedCSS:{width:'30%',top:'40%',left:'35%'},overlayCSS:{backgroundColor:'#000',opacity:0.1,cursor:'wait'},growlCSS:{width:'350px',top:'10px',left:'',right:'10px',border:'none',padding:'5px',opacity:0.6,cursor:'default',color:'#fff',backgroundColor:'#000','-webkit-border-radius':'10px','-moz-border-radius':'10px'},iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank',forceIframe:false,baseZ:2147483640,centerX:true,centerY:true,allowBodyStretch:true,bindEvents:true,constrainTabKey:true,fadeIn:200,fadeOut:400,timeout:0,showOverlay:true,focusInput:true,applyPlatformOpacityRules:false,onBlock:null,onUnblock:null,quirksmodeOffsetHack:4};var pageBlock=null;var pageBlockEls=[];function install(el,opts){var full=(el==window);var msg=opts&&opts.message!==undefined?opts.message:undefined;if($.blockUI.defaults.message==''){$.blockUI.defaults.message='<img src="'+DWIN.image('common/loading_overlay.gif')+'" title="'+DWIN.i18n.t('Please Wait...')+'" alt="'+DWIN.i18n.t('Please Wait...')+'" />'}opts=$.extend({},$.blockUI.defaults,opts||{});opts.overlayCSS=$.extend({},$.blockUI.defaults.overlayCSS,opts.overlayCSS||{});var css=$.extend({},$.blockUI.defaults.css,opts.css||{});var themedCSS=$.extend({},$.blockUI.defaults.themedCSS,opts.themedCSS||{});msg=msg===undefined?opts.message:msg;if(full&&pageBlock)remove(window,{fadeOut:0});if(msg&&typeof msg!='string'&&(msg.parentNode||msg.jquery)){var node=msg.jquery?msg[0]:msg;var data={};$(el).data('blockUI.history',data);data.el=node;data.parent=node.parentNode;data.display=node.style.display;data.position=node.style.position;if(data.parent)data.parent.removeChild(node)}var z=opts.baseZ;var lyr1=($.browser.msie||opts.forceIframe)?$('<iframe class="blockUI" style="z-index:'+(z++)+';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+opts.iframeSrc+'"></iframe>'):$('<div class="blockUI" style="display:none"></div>');var lyr2=$('<div class="blockUI blockOverlay" style="z-index:'+(z++)+';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');var lyr3;if(opts.theme&&full){var s='<div class="blockUI blockMsg blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+z+';display:none;position:fixed">'+'<div class="ui-widget-header ui-dialog-titlebar blockTitle">'+(opts.title||'&nbsp;')+'</div>'+'<div class="ui-widget-content ui-dialog-content"></div>'+'</div>';lyr3=$(s)}else{lyr3=full?$('<div class="blockUI blockMsg blockPage" style="z-index:'+z+';display:none;position:fixed"></div>'):$('<div class="blockUI blockMsg blockElement" style="z-index:'+z+';display:none;position:absolute"></div>')}if(msg){if(opts.theme){lyr3.css(themedCSS);lyr3.addClass('ui-widget-content')}else lyr3.css(css)}if(!opts.applyPlatformOpacityRules||!($.browser.mozilla&&/Linux/.test(navigator.platform)))lyr2.css(opts.overlayCSS);lyr2.css('position',full?'fixed':'absolute');if($.browser.msie||opts.forceIframe)lyr1.css('opacity',0.0);var layers=[lyr1,lyr2,lyr3],$par=full?$('body'):$(el);$.each(layers,function(){this.appendTo($par)});if(opts.theme&&opts.draggable&&$.fn.draggable){lyr3.draggable({handle:'.ui-dialog-titlebar',cancel:'li'})}var expr=setExpr&&(!$.boxModel||$('object,embed',full?null:el).length>0);if(ie6||expr){if(full&&opts.allowBodyStretch&&$.boxModel)$('html,body').css('height','100%');if((ie6||!$.boxModel)&&!full){var t=sz(el,'borderTopWidth'),l=sz(el,'borderLeftWidth');var fixT=t?'(0 - '+t+')':0;var fixL=l?'(0 - '+l+')':0}$.each([lyr1,lyr2,lyr3],function(i,o){var s=o[0].style;s.position='absolute';if(i<2){full?s.setExpression('height','Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.boxModel?0:'+opts.quirksmodeOffsetHack+') + "px"'):s.setExpression('height','this.parentNode.offsetHeight + "px"');full?s.setExpression('width','jQuery.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):s.setExpression('width','this.parentNode.offsetWidth + "px"');if(fixL)s.setExpression('left',fixL);if(fixT)s.setExpression('top',fixT)}else if(opts.centerY){if(full)s.setExpression('top','(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');s.marginTop=0}else if(!opts.centerY&&full){var top=(opts.css&&opts.css.top)?parseInt(opts.css.top):0;var expression='((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + '+top+') + "px"';s.setExpression('top',expression)}})}if(msg){if(opts.theme)lyr3.find('.ui-widget-content').append(msg);else lyr3.append(msg);if(msg.jquery||msg.nodeType)$(msg).show()}if(($.browser.msie||opts.forceIframe)&&opts.showOverlay)lyr1.show();if(opts.fadeIn){var cb=opts.onBlock?opts.onBlock:noOp;var cb1=(opts.showOverlay&&!msg)?cb:noOp;var cb2=msg?cb:noOp;if(opts.showOverlay)lyr2._fadeIn(opts.fadeIn,cb1);if(msg)lyr3._fadeIn(opts.fadeIn,cb2)}else{if(opts.showOverlay)lyr2.show();if(msg)lyr3.show();if(opts.onBlock)opts.onBlock()}bind(1,el,opts);if(full){pageBlock=lyr3[0];pageBlockEls=$(':input:enabled:visible',pageBlock);if(opts.focusInput)setTimeout(focus,20)}else center(lyr3[0],opts.centerX,opts.centerY);if(opts.timeout){var to=setTimeout(function(){full?$.unblockUI(opts):$(el).unblock(opts)},opts.timeout);$(el).data('blockUI.timeout',to)}};function remove(el,opts){var full=(el==window);var $el=$(el);var data=$el.data('blockUI.history');var to=$el.data('blockUI.timeout');if(to){clearTimeout(to);$el.removeData('blockUI.timeout')}opts=$.extend({},$.blockUI.defaults,opts||{});bind(0,el,opts);var els;if(full)els=$('body').children().filter('.blockUI').add('body > .blockUI');else els=$('.blockUI',el);if(full)pageBlock=pageBlockEls=null;if(opts.fadeOut){els.fadeOut(opts.fadeOut);setTimeout(function(){reset(els,data,opts,el)},opts.fadeOut)}else reset(els,data,opts,el)};function reset(els,data,opts,el){els.each(function(i,o){if(this.parentNode)this.parentNode.removeChild(this)});if(data&&data.el){data.el.style.display=data.display;data.el.style.position=data.position;if(data.parent)data.parent.appendChild(data.el);$(el).removeData('blockUI.history')}if(typeof opts.onUnblock=='function')opts.onUnblock(el,opts)};function bind(b,el,opts){var full=el==window,$el=$(el);if(!b&&(full&&!pageBlock||!full&&!$el.data('blockUI.isBlocked')))return;if(!full)$el.data('blockUI.isBlocked',b);if(!opts.bindEvents||(b&&!opts.showOverlay))return;var events='mousedown mouseup keydown keypress';b?$(document).bind(events,opts,handler):$(document).unbind(events,handler)};function handler(e){if(e.keyCode&&e.keyCode==9){if(pageBlock&&e.data.constrainTabKey){var els=pageBlockEls;var fwd=!e.shiftKey&&e.target==els[els.length-1];var back=e.shiftKey&&e.target==els[0];if(fwd||back){setTimeout(function(){focus(back)},10);return false}}}if($(e.target).parents('div.blockMsg').length>0)return true;return $(e.target).parents().children().filter('div.blockUI').length==0};function focus(back){if(!pageBlockEls)return;var e=pageBlockEls[back===true?pageBlockEls.length-1:0];if(e)e.focus()};function center(el,x,y){var p=el.parentNode,s=el.style;var l=((p.offsetWidth-el.offsetWidth)/2)-sz(p,'borderLeftWidth');var t=((p.offsetHeight-el.offsetHeight)/2)-sz(p,'borderTopWidth');if(x)s.left=l>0?(l+'px'):'0';if(y)s.top=t>0?(t+'px'):'0'};function sz(el,p){return parseInt($.css(el,p))||0}})(jQuery);(function($){$.alerts={verticalOffset:-75,horizontalOffset:0,repositionOnResize:true,overlayOpacity:0,overlayColor:'#fff',borderOpacity:0.75,borderColor:'#bbb',draggable:true,dialogClass:null,alert:function(message,title,callback){if(title===null){title=DWIN.i18n('Alert')}$.alerts._show(title,message,null,'alert',function(result){if(callback){callback(result)}})},confirm:function(message,title,callback){if(title===null){title=DWIN.i18n.t('Confirm')}$.alerts._show(title,message,null,'confirm',function(result){if(callback){callback(result)}})},prompt:function(message,value,title,callback){if(title===null){title=DWIN.i18n.t('Prompt')}$.alerts._show(title,message,value,'prompt',function(result){if(callback){callback(result)}})},_show:function(title,msg,value,type,callback){$.alerts._hide();$.alerts._overlay('show');$.alerts._border('show');$("BODY").append('<div id="popup_container">'+'<div id="popup_title"></div>'+'<div id="popup_content">'+'<div id="popup_message"></div>'+'</div>'+'</div>');var className=($.alerts.dialogClass)?$.alerts.dialogClass:type;$("#popup_container").addClass(className);var pos=($.browser.msie&&parseInt($.browser.version)<=6)?'absolute':'fixed';$("#popup_container").css({position:pos,zIndex:999999999,padding:0,margin:0});$("#popup_title").text(title);$("#popup_content").addClass(className);$("#popup_message").text(msg);$("#popup_message").html($("#popup_message").text().replace(/\n/g,'<br />'));$("#popup_container").css({minWidth:$("#popup_container").outerWidth(),maxWidth:$("#popup_container").outerWidth()});switch(type){case'alert':$("#popup_message").after('<div id="popup_panel"><img src="'+DWIN.image('common/buttons/ok.gif')+'" id="popup_ok" class="pointer" /></div>');$("#popup_ok").click(function(){$.alerts._hide();callback(true)});$("#popup_ok").focus().keypress(function(e){if(e.keyCode==13||e.keyCode==27){$("#popup_ok").trigger('click')}});break;case'confirm':$("#popup_message").after('<div id="popup_panel"><img src="'+DWIN.image('common/buttons/cancel.gif')+'" id="popup_cancel" class="pointer"/><img src="'+DWIN.image('common/buttons/ok.gif')+'" id="popup_ok" class="pointer" style="margin-right:4px" /></div>');$("#popup_ok").click(function(){$.alerts._hide();if(callback){callback(true)}});$("#popup_cancel").click(function(){$.alerts._hide();if(callback){callback(false)}});$("#popup_ok").focus();$("#popup_ok, #popup_cancel").keypress(function(e){if(e.keyCode==13){$("#popup_ok").trigger('click')}if(e.keyCode==27){$("#popup_cancel").trigger('click')}});break;case'prompt':$("#popup_message").append('<br /><input type="text" size="30" id="popup_prompt" />').after('<div id="popup_panel"><img src="'+DWIN.image('common/buttons/cancel.gif')+'" id="popup_cancel" class="pointer"/><img src="'+DWIN.image('common/buttons/ok.gif')+'" id="popup_ok" class="pointer" style="margin-right:4px" /></div>');$("#popup_prompt").width($("#popup_message").width());$("#popup_ok").click(function(){var val=$("#popup_prompt").val();$.alerts._hide();if(callback){callback(val)}});$("#popup_cancel").click(function(){$.alerts._hide();if(callback){callback(null)}});$("#popup_prompt, #popup_ok, #popup_cancel").keypress(function(e){if(e.keyCode==13){$("#popup_ok").trigger('click')}if(e.keyCode==27){$("#popup_cancel").trigger('click')}});if(value){$("#popup_prompt").val(value)}$("#popup_prompt").focus().select();break}$.alerts._reposition();$.alerts._maintainPosition(true)},_hide:function(){$("#popup_container").remove();$.alerts._overlay('hide');$.alerts._border('hide');$.alerts._maintainPosition(false)},_overlay:function(status){switch(status){case'show':$.alerts._overlay('hide');$("BODY").append('<div id="popup_overlay"></div>');$("#popup_overlay").css({position:'absolute',zIndex:999999998,top:'0px',left:'0px',width:'100%',height:$(document).height(),background:$.alerts.overlayColor,opacity:$.alerts.overlayOpacity});break;case'hide':$("#popup_overlay").remove();break}},_border:function(status){switch(status){case'show':$.alerts._border('hide');$("BODY").append('<div id="popup_border"></div>');var pos=($.browser.msie&&parseInt($.browser.version)<=6)?'absolute':'fixed';$("#popup_border").css({position:pos,zIndex:999999999,top:'0px',left:'0px',width:'100%',height:$(document).height(),background:$.alerts.borderColor,opacity:$.alerts.borderOpacity});break;case'hide':$("#popup_border").remove();break}},_reposition:function(){var top=(($(window).height()/2)-($("#popup_container").outerHeight()/2))+$.alerts.verticalOffset;var left=(($(window).width()/2)-($("#popup_container").outerWidth()/2))+$.alerts.horizontalOffset;if(top<0){top=0}if(left<0){left=0}if($.browser.msie&&parseInt($.browser.version)<=6){top=top+$(window).scrollTop()}$("#popup_container").css({top:top+'px',left:left+'px'});$("#popup_border").css({top:top-10+'px',left:left-10+'px'});$("#popup_border").height($("#popup_container").height()+22);$("#popup_border").width($("#popup_container").width()+22);$("#popup_title").width($("#popup_content").width()+14);$("#popup_overlay").height($(document).height())},_maintainPosition:function(status){if($.alerts.repositionOnResize){switch(status){case true:$(window).bind('resize',function(){$.alerts._reposition()});break;case false:$(window).unbind('resize');break}}}}})(jQuery);(function($){var _activeEditors=[];$.fn.inlineEdit=function(url,options){var defaults={additionalData:null,onSuccess:function(){},limit:4000};options=$.extend({},defaults,options);this.data('url',url);this.data('additionalData',options.additionalData);this.data('callback',options.onSuccess);this.find('.editable').each(function(){var e=$(this);e.click(function(){_enableEditor(this,options.limit)}).mouseover(function(){e.addClass('active')}).mouseout(function(){e.removeClass('active')})});this.find('textarea').keyup(function(){var height=$(this).get(0).scrollHeight;var maxHeight=$(this).css('maxHeight').substr(0,$(this).css('maxHeight').length-2);$(this).height(height);if(maxHeight>0&&height>=maxHeight){$(this).css('overflowY','scroll')}else{$(this).css('overflow','hidden')}});$(this).children().find('.inlineActionBox').children().each(function(){$(this).click(function(){_action(this)})});_loadValues(this)};function _loadValues(div){div.find(':input[type=text], textarea').each(function(){div.data(this.id,this.value)});div.find(':input[type=checkbox]').each(function(){div.data(this.id,this.checked)});div.find('select').each(function(){div.data(this.id,this.selectedIndex)})}function _enableEditor(element,limit){var formEl=$(element).next().find('textarea');formEl.css({'height':$(element).height()+15,'border':'1px solid #d6d6d6','width':$(element).width()-2});var htmlElements={whitespace:['p','ul','ol','table','tbody','tr'],nowhitespace:['li','h3','h4','h5','h6','blockquote','th','td']};var whitespace=true;if(typeof CKEDITOR!=="undefined"&&formEl.hasClass('wysiwyg')){CKEDITOR.on('dialogDefinition',function(ev){var dialogName=ev.data.name;var dialogDefinition=ev.data.definition;if(dialogName=='link'){var infoTab=dialogDefinition.getContents('info');infoTab.remove('linkType');infoTab.remove('protocol');dialogDefinition.removeContents('target');dialogDefinition.removeContents('advanced')}});CKEDITOR.replace(formEl.attr('name'),{characterLimit:limit,on:{instanceReady:function(ev){for(i in htmlElements){if(htmlElements.hasOwnProperty(i)){whitespace=i=='whitespace';this.dataProcessor.writer.indentationChars='    ';for(var j=0;j<htmlElements[i].length;j++){this.dataProcessor.writer.setRules(htmlElements[i][j],{indent:true,breakBeforeOpen:false,breakAfterOpen:whitespace,breakBeforeClose:whitespace,breakAfterClose:true})}}}}}});var editor=CKEDITOR.instances[formEl.attr('name')];editor.on('focus',function(event){var originalData=editor.getData();var intervalId=window.setInterval(function(){if(editor.getData()!=originalData){clearInterval(intervalId);$('a[href][href!=#]').click(DWIN.confirmOnUnsavedChanges);_watchInput(formEl.attr('id'))}},500,event.editor)})}$(element).hide().next().show();formEl.change(function(){formEl.unbind('change');$('a[href][href!=#]').click(DWIN.confirmOnUnsavedChanges);_watchInput(formEl.attr('id'))})}function _action(button){var input=$(button).parent().siblings(':first').get(0);var name=input.attributes.getNamedItem('name').value;if(typeof CKEDITOR!=="undefined"&&CKEDITOR.instances[name]){input.value=CKEDITOR.instances[name].getData()}var div=$(input).parent().parent();if('inlineCancel'==button.className){if('checkbox'==input.type){input.checked=div.data(input.id)}else if('select'==input.type){input.selectedIndex=div.data(input.id)}else{input.value=div.data(input.id)}$(input).parent().hide().prev().show();$(input).parent().find('.errorMessage').remove();_removeCKEditor(input.attributes.getNamedItem('name').value)}if('inlineSave'==button.className){_submit(input,{field:input.id,value:input.value})}_unwatchInput(input.id);if(_watchTotal()===0){$('a').unbind('click',DWIN.confirmOnUnsavedChanges)}}function _submit(input,payload){var edit=$(input).parent();var div=edit.parent();div.block({message:''});if(div.data('additionalData')){payload=$.extend({},payload,div.data('additionalData'))}edit.find('.errorMessage').remove();$.post(div.data('url'),payload,function(json){if(json.valid){var newContent=String(json.value).replace(/\r?\n/g,"<br/>\n")+'<span class="editableIcon"></span>';edit.hide().prev().html(newContent).show();var newInput=edit.find('textarea, input[type=text]').clone().val(json.value);edit.find('textarea, input[type=text]').replaceWith(newInput);_loadValues(div);if(div.data('callback')&&('function'==typeof div.data('callback'))){div.data('callback').apply()}_removeCKEditor(input.attributes.getNamedItem('name').value)}else{$.each(json.errors,function(){edit.append('<p class="errorMessage">'+String(this)+'</p>')})}div.unblock()},'json')}function _watchInput(input){if($.inArray(input,_activeEditors)===-1){_activeEditors.push(input)}}function _unwatchInput(input){var pos=$.inArray(input,_activeEditors);if(pos>-1){_activeEditors.splice(pos,1)}}function _watchTotal(){return _activeEditors.length}function _removeCKEditor(name){if(typeof CKEDITOR!=="undefined"&&CKEDITOR.instances[name]){CKEDITOR.instances[name].destroy()}}})(jQuery);(function($){function _displayMessages(selector,messages,statusClass,timeout){$(selector+' .validationMessage').remove();var div=$('<div>').attr('class','validationMessage');$(messages).each(function(){$(div).append('<p class="'+statusClass+'">'+this+'</p>')});$(div).prependTo(selector);if(timeout){$(div).delay(timeout).fadeOut('slow')}}$.displaySuccessMessage=function(selector,messages,timeout){_displayMessages(selector,messages,'successMessage',timeout)};$.displayErrorMessage=function(selector,messages,timeout){_displayMessages(selector,messages,'errorMessage',timeout)}})(jQuery);(function($){$.fn.extend({notify:function(){return this.each(function(){var el=$(this);slideUp(el)})}});function slideUp(el){el.animate({opacity:1,bottom:'0'},500,function(){var viewing=$('a','#section');var close=$('#section',el).children().eq(1);close.click(function(){slideDown(el)})})}function slideDown(el){el.animate({opacity:'0',bottom:'-99px'},1000)}})(jQuery);(function($d){$d.keepAlive=function(){var frequency=1000*60*15;var refresh=function(){setTimeout(refresh,frequency);$.get('/user/index/xhr-session-keep-alive')};setTimeout(refresh,frequency)};$d.videoInit=function(){$('.videoLink').live('click',function(){var url=$('img.infoVideo, img.infoVideoMenuBar',this).attr('data-video');var title=$('img.infoVideo, img.infoVideoMenuBar',this).attr('title');$(this).modalVideo({url:url,title:title})})}})(DWIN);var CKEDITOR_BASEPATH='/ckeditor/';(function($a,$){var _url=window.location.href;var _urlParts=_url.split('?')[0].split('/');var _account={network:(function(){if(/^(affiliate|merchant)$/g.test(_urlParts[3])){_urlParts.splice(3,0,'awin')}return _urlParts[3]}()),accountType:_urlParts[4],linkedAccountId:_urlParts[5],promotionId:(function(){var castedSegment=_urlParts[6]-0;if(isNaN(castedSegment)){return null}return castedSegment}()),controller:(typeof _urlParts[6]!='undefined')?_urlParts[6]:'index',action:(typeof _urlParts[7]!='undefined')?_urlParts[7].replace('#',''):'index'};$a.getBaseUrl=function(){return'/'+_account.network+'/'+_account.accountType+'/'+_account.linkedAccountId+'/'};$a.getPromotionBaseUrl=function(){var url=$a.getBaseUrl();if(_account.promotionId!==null){url+=_account.promotionId+'/'}return url};$a.getDetails=function(){return _account};$a.getNetwork=function(){return _account.network}})(DWIN.Account={},jQuery);(function($p,$){var _mailboxUrl='/user/mail/xhr-check-inbox';var _mailboxRefreshTime=1000*60*5;var _dateRefreshTime=1000*60;var _open=[];function _refreshDate(){var d=new Date();var hour=d.getHours();var min=d.getMinutes();if(min<10){min="0"+min}if(hour<10){hour="0"+hour}var time=hour+':'+min;var date=d.getDate()+'/'+(d.getMonth()+1)+'/'+d.getFullYear();$('#dateTimeDisplay').html('<strong>'+date+'</strong> '+time)}function _refreshMailbox(){$.getJSON(_mailboxUrl,null,function(json){$('#mailboxCounter').text(json.count).toggleClass('unread',json.count>0)})}function _handleDropdowns(){$.each({'#settingsCog':'#settingsMenu','#accountSwitcher':'#cpAccountList','#userHome':'#subMenu'},function(k,v){$p.dropdown(k,v)})}$p.refreshActivity=function(){$.get('/user/activity-stream/xhr-status',function(data){var button=$('ul#controlPanelButtons li a#activityStream');button.toggleClass('newNotification',data.hasNew);button.find('span').html(data.eventCount)})};$p.dropdown=function(button,menu){$(button).live('mouseenter',function(e){$(menu).slideDown(100);_open[button]=true});$(button).live('mouseleave',function(e){_open[button]=false;setTimeout(function(){if(!_open[button]){$(menu).slideUp(100)}},150)})};function _userContextHomeMenu(){var follow=false;$('#subMenu').click(function(evt){var el=evt.target;if($(el).hasClass('tick')){return follow}if($(el).attr('id')==='homepage'){follow=false;$.ajax({type:'post',url:'/user/homepage/xhr-set-homepage',data:{url:$(el).attr('href'),newurl:window.location.href},dataType:'json',success:function(data){if(data.saved){$(el).toggleClass('tick','empty');$(el).html(DWIN.i18n.t('js.control-panel.userHomepage'));$('a#home, div#headerLogo a').attr('href',$(el).attr('href'));DWIN.showSuccess(data.msg)}else{DWIN.showError(data.msg)}}})}if($(el).attr('id')==='dash-board'){follow=true}return follow})}function _attachLanguageSelector(){$('#userLocale').click(function(){$.modalForm('/translate/xhr-locale-selector',null,{attachSaveAndCancel:true,width:550,form:'#localeSelectorForm',blockUI:true,url:'/user/settings/xhr-update-locale',onSaveSuccess:function(){$.blockUI({overlayCSS:{opacity:0.5}});top.location.href=top.location.href}})})}$p.init=function(){_handleDropdowns();_userContextHomeMenu();_attachLanguageSelector()}})(DWIN.ControlPanel={},jQuery);(function($t,$){var _inputs={affiliates:'#affiliate',merchants:'#merchant'};$t.init=function(){$.each(_inputs,function(key,id){if($(id).val()===''){$(id).val($(id).attr('title'))}$(id).focus(function(){if($(id).val()===$(this).attr('title')){$(id).val('').addClass('focused')}});$(id).blur(function(){if($(id).val()===''){$(id).val($(id).attr('title')).removeClass('focused')}});$(id).parent().submit(function(){if(!parseInt($(id).val(),10)){return false}})});$('#providerToolbar form[name^="redirectTo"]').each(function(){$(this).submit(function(){var data={};$(this).find('input[type!="image"]').each(function(){data[$(this).attr('name')]=$(this).val()});$.getJSON('/provider/index/xhr-match-accounts',data,function(response){if(response.found==1){window.location.href=response['accounts'][0].url}else if(response.found>1){var str='';for(var i in response.accounts){str+='<li class="'+response.accounts[i]['network']+'"><a href="'+response.accounts[i]['url']+'">'+response.accounts[i]['name']+'</a></li>'}str+='</ul>';$('body').append('<div id="switcherModal" style="display:none"><h1 class="headerGradient">'+DWIN.i18n.t('js.provider.toolbar.selectAccount')+'</h1><p>'+DWIN.i18n.t('js.provider.toolbar.accountsMatched',[response.found])+'</p><ul>'+str+'</ul></div>');$('#switcherModal').modal()}else{DWIN.showError(DWIN.i18n.t('js.provider.toolbar.noAccountsExist'),DWIN.i18n.t('js.general.error'))}});return false})})}})(DWIN.ProviderToolbar={},jQuery);DWIN.Table=function(baseUrl,containerId,successCallback,orderCallback,messageCallback){var $=jQuery;var _baseUrl=baseUrl;var _requestUrl;var _container=$('#'+containerId);var _successCallback=successCallback;var _orderCallback=orderCallback;var _messageCallback=messageCallback;var _page;var _sort;var _order;var _blocked=false;this.data={};this.post=false;this.blockUI=false;this.paramNames={page:'page',sort:'sort',order:'order'};function _attachHandlers(self){_container.find('div.pagination span').each(function(){if($(this).attr('data-page')>0){$(this).click(function(){self.load($(this).attr('data-page'),_sort,_order)})}});_container.find('th.sortable').each(function(i){$(this).click(function(){if($(this).find('span[class=""]').data('defaultsortmode')){var order=$(this).find('span').attr('data-defaultsortmode').toLowerCase()}else{var order=($(this).hasClass('desc')?'desc':'asc')}if(this.id==_sort){order=_order=='desc'?'asc':'desc'}_sort=this.id;_order=order;if(_orderCallback){_orderCallback(self)}self.load(1,this.id,order)})})};this.getSort=function(){return _sort};this.getOrder=function(){return _order};this.getPage=function(){return _page};this.init=function(){_attachHandlers(this)};this.getData=function(){return this.data};this.setParam=function(paramName,value){this.data[paramName]=value};this.reset=function(){_container.html('')};this.block=function(){if(!_blocked){_blocked=true;_container.block()}};this.unblock=function(){_blocked=false;_container.unblock()};this.load=function(page,sort,order){if(sort){_sort=sort}if(order){_order=order}if(page){_page=page}_requestUrl=_baseUrl+(_baseUrl.slice(-1)=='/'?'':'/');var type='get';var self=this;if(true===this.post){type='post'}else{if(!$.isEmptyObject(this.data)){$.each(this.data,function(key,value){_requestUrl+=encodeURIComponent(key.replace('/',' '))+'/'+encodeURIComponent(value.replace('/',' '))+'/'})}}if(true===this.blockUI){if(!_container.html()){_container.html('<div class="tempDiv">'+DWIN.i18n.t('js.general.loading')+'</div>')}this.block()}$.ajax({type:type,data:(this.data)?this.data:null,url:this.url(_page,_sort,_order),success:function(html){if(html.message!==undefined){_container.html('');if(_messageCallback){_messageCallback(html)}else{DWIN.showInfo(html.message)}}else{_container.html(html);_attachHandlers(self);if(_successCallback){_successCallback(self)}}},complete:this.unblock})};this.url=function(page,sort,order){var url=_requestUrl;if(page||_page){url+=this.paramNames.page+'/'+(page||_page)+'/'}if(sort||_sort){url+=this.paramNames.sort+'/'+(sort||_sort)+'/'}if(order||_order){url+=this.paramNames.order+'/'+(order||_order)+'/'}return url}};(function($){$.fn.ajaxSubmit=function(options){if(!this.length){log('ajaxSubmit: skipping submit process - no element selected');return this}var method,action,url,$form=this;if(typeof options=='function'){options={success:options}}method=this.attr('method');action=this.attr('action');url=(typeof action==='string')?$.trim(action):'';url=url||window.location.href||'';if(url){url=(url.match(/^([^#]+)/)||[])[1]}options=$.extend(true,{url:url,success:$.ajaxSettings.success,type:method||'GET',iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank'},options);var veto={};this.trigger('form-pre-serialize',[this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-pre-serialize trigger');return this}if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log('ajaxSubmit: submit aborted via beforeSerialize callback');return this}var n,v,a=this.formToArray(options.semantic);if(options.data){options.extraData=options.data;for(n in options.data){if($.isArray(options.data[n])){for(var k in options.data[n]){a.push({name:n,value:options.data[n][k]})}}else{v=options.data[n];v=$.isFunction(v)?v():v;a.push({name:n,value:v})}}}if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log('ajaxSubmit: submit aborted via beforeSubmit callback');return this}this.trigger('form-submit-validate',[a,this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-submit-validate trigger');return this}var q=$.param(a);if(options.type.toUpperCase()=='GET'){options.url+=(options.url.indexOf('?')>=0?'&':'?')+q;options.data=null}else{options.data=q}var callbacks=[];if(options.resetForm){callbacks.push(function(){$form.resetForm()})}if(options.clearForm){callbacks.push(function(){$form.clearForm()})}if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){var fn=options.replaceTarget?'replaceWith':'html';$(options.target)[fn](data).each(oldSuccess,arguments)})}else if(options.success){callbacks.push(options.success)}options.success=function(data,status,xhr){var context=options.context||options;for(var i=0,max=callbacks.length;i<max;i++){callbacks[i].apply(context,[data,status,xhr||$form,$form])}};var fileInputs=$('input:file',this).length>0;var mp='multipart/form-data';var multipart=($form.attr('enctype')==mp||$form.attr('encoding')==mp);if(options.iframe!==false&&(fileInputs||options.iframe||multipart)){if(options.closeKeepAlive){$.get(options.closeKeepAlive,function(){fileUpload(a)})}else{fileUpload(a)}}else{if($.browser.msie&&method=='get'){var ieMeth=$form[0].getAttribute('method');if(typeof ieMeth==='string')options.type=ieMeth}$.ajax(options)}this.trigger('form-submit-notify',[this,options]);return this;function fileUpload(a){var form=$form[0],el,i,s,g,id,$io,io,xhr,sub,n,timedOut,timeoutHandle;var useProp=!!$.fn.prop;if(a){for(i=0;i<a.length;i++){el=$(form[a[i].name]);el[useProp?'prop':'attr']('disabled',false)}}if($(':input[name=submit],:input[id=submit]',form).length){alert('Error: Form elements must not have name or id of "submit".');return}s=$.extend(true,{},$.ajaxSettings,options);s.context=s.context||s;id='jqFormIO'+(new Date().getTime());if(s.iframeTarget){$io=$(s.iframeTarget);n=$io.attr('name');if(n==null)$io.attr('name',id);else id=n}else{$io=$('<iframe name="'+id+'" src="'+s.iframeSrc+'" />');$io.css({position:'absolute',top:'-1000px',left:'-1000px'})}io=$io[0];xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:'n/a',getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(status){var e=(status==='timeout'?'timeout':'aborted');log('aborting upload... '+e);this.aborted=1;$io.attr('src',s.iframeSrc);xhr.error=e;s.error&&s.error.call(s.context,xhr,e,status);g&&$.event.trigger("ajaxError",[xhr,s,e]);s.complete&&s.complete.call(s.context,xhr,e)}};g=s.global;if(g&&!$.active++){$.event.trigger("ajaxStart")}if(g){$.event.trigger("ajaxSend",[xhr,s])}if(s.beforeSend&&s.beforeSend.call(s.context,xhr,s)===false){if(s.global){$.active--}return}if(xhr.aborted){return}sub=form.clk;if(sub){n=sub.name;if(n&&!sub.disabled){s.extraData=s.extraData||{};s.extraData[n]=sub.value;if(sub.type=="image"){s.extraData[n+'.x']=form.clk_x;s.extraData[n+'.y']=form.clk_y}}}var CLIENT_TIMEOUT_ABORT=1;var SERVER_ABORT=2;function getDoc(frame){var doc=frame.contentWindow?frame.contentWindow.document:frame.contentDocument?frame.contentDocument:frame.document;return doc}function doSubmit(){var t=$form.attr('target'),a=$form.attr('action');form.setAttribute('target',id);if(!method){form.setAttribute('method','POST')}if(a!=s.url){form.setAttribute('action',s.url)}if(!s.skipEncodingOverride&&(!method||/post/i.test(method))){$form.attr({encoding:'multipart/form-data',enctype:'multipart/form-data'})}if(s.timeout){timeoutHandle=setTimeout(function(){timedOut=true;cb(CLIENT_TIMEOUT_ABORT)},s.timeout)}function checkState(){try{var state=getDoc(io).readyState;log('state = '+state);if(state.toLowerCase()=='uninitialized')setTimeout(checkState,50)}catch(e){log('Server abort: ',e,' (',e.name,')');cb(SERVER_ABORT);timeoutHandle&&clearTimeout(timeoutHandle);timeoutHandle=undefined}}var extraInputs=[];try{if(s.extraData){for(var n in s.extraData){extraInputs.push($('<input type="hidden" name="'+n+'" />').attr('value',s.extraData[n]).appendTo(form)[0])}}if(!s.iframeTarget){$io.appendTo('body');io.attachEvent?io.attachEvent('onload',cb):io.addEventListener('load',cb,false)}setTimeout(checkState,15);form.submit()}finally{form.setAttribute('action',a);if(t){form.setAttribute('target',t)}else{$form.removeAttr('target')}$(extraInputs).remove()}}if(s.forceSync){doSubmit()}else{setTimeout(doSubmit,10)}var data,doc,domCheckCount=50,callbackProcessed;function cb(e){if(xhr.aborted||callbackProcessed){return}try{doc=getDoc(io)}catch(ex){log('cannot access response document: ',ex);e=SERVER_ABORT}if(e===CLIENT_TIMEOUT_ABORT&&xhr){xhr.abort('timeout');return}else if(e==SERVER_ABORT&&xhr){xhr.abort('server abort');return}if(!doc||doc.location.href==s.iframeSrc){if(!timedOut)return}io.detachEvent?io.detachEvent('onload',cb):io.removeEventListener('load',cb,false);var status='success',errMsg;try{if(timedOut){throw'timeout'}var isXml=s.dataType=='xml'||doc.XMLDocument||$.isXMLDoc(doc);log('isXml='+isXml);if(!isXml&&window.opera&&(doc.body==null||doc.body.innerHTML=='')){if(--domCheckCount){log('requeing onLoad callback, DOM not available');setTimeout(cb,250);return}}var docRoot=doc.body?doc.body:doc.documentElement;xhr.responseText=docRoot?docRoot.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;if(isXml)s.dataType='xml';xhr.getResponseHeader=function(header){var headers={'content-type':s.dataType};return headers[header]};if(docRoot){xhr.status=Number(docRoot.getAttribute('status'))||xhr.status;xhr.statusText=docRoot.getAttribute('statusText')||xhr.statusText}var dt=s.dataType||'';var scr=/(json|script|text)/.test(dt.toLowerCase());if(scr||s.textarea){var ta=doc.getElementsByTagName('textarea')[0];if(ta){xhr.responseText=ta.value;xhr.status=Number(ta.getAttribute('status'))||xhr.status;xhr.statusText=ta.getAttribute('statusText')||xhr.statusText}else if(scr){var pre=doc.getElementsByTagName('pre')[0];var b=doc.getElementsByTagName('body')[0];if(pre){xhr.responseText=pre.textContent?pre.textContent:pre.innerHTML}else if(b){xhr.responseText=b.innerHTML}}}else if(s.dataType=='xml'&&!xhr.responseXML&&xhr.responseText!=null){xhr.responseXML=toXml(xhr.responseText)}try{data=httpData(xhr,s.dataType,s)}catch(e){status='parsererror';xhr.error=errMsg=(e||status)}}catch(e){log('error caught: ',e);status='error';xhr.error=errMsg=(e||status)}if(xhr.aborted){log('upload aborted');status=null}if(xhr.status){status=(xhr.status>=200&&xhr.status<300||xhr.status===304)?'success':'error'}if(status==='success'){s.success&&s.success.call(s.context,data,'success',xhr);g&&$.event.trigger("ajaxSuccess",[xhr,s])}else if(status){if(errMsg==undefined)errMsg=xhr.statusText;s.error&&s.error.call(s.context,xhr,status,errMsg);g&&$.event.trigger("ajaxError",[xhr,s,errMsg])}g&&$.event.trigger("ajaxComplete",[xhr,s]);if(g&&!--$.active){$.event.trigger("ajaxStop")}s.complete&&s.complete.call(s.context,xhr,status);callbackProcessed=true;if(s.timeout)clearTimeout(timeoutHandle);setTimeout(function(){if(!s.iframeTarget)$io.remove();xhr.responseXML=null},100)}var toXml=$.parseXML||function(s,doc){if(window.ActiveXObject){doc=new ActiveXObject('Microsoft.XMLDOM');doc.async='false';doc.loadXML(s)}else{doc=(new DOMParser()).parseFromString(s,'text/xml')}return(doc&&doc.documentElement&&doc.documentElement.nodeName!='parsererror')?doc:null};var parseJSON=$.parseJSON||function(s){return window['eval']('('+s+')')};var httpData=function(xhr,type,s){var ct=xhr.getResponseHeader('content-type')||'',xml=type==='xml'||!type&&ct.indexOf('xml')>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.nodeName==='parsererror'){$.error&&$.error('parsererror')}if(s&&s.dataFilter){data=s.dataFilter(data,type)}if(typeof data==='string'){if(type==='json'||!type&&ct.indexOf('json')>=0){data=parseJSON(data)}else if(type==="script"||!type&&ct.indexOf("javascript")>=0){$.globalEval(data)}}return data}}};$.fn.ajaxForm=function(options){if(this.length===0){var o={s:this.selector,c:this.context};if(!$.isReady&&o.s){log('DOM not ready, queuing ajaxForm');$(function(){$(o.s,o.c).ajaxForm(options)});return this}log('terminating; zero elements found by selector'+($.isReady?'':' (DOM not ready)'));return this}return this.ajaxFormUnbind().bind('submit.form-plugin',function(e){if(!e.isDefaultPrevented()){e.preventDefault();$(this).ajaxSubmit(options)}}).bind('click.form-plugin',function(e){var target=e.target;var $el=$(target);if(!($el.is(":submit,input:image"))){var t=$el.closest(':submit');if(t.length==0){return}target=t[0]}var form=this;form.clk=target;if(target.type=='image'){if(e.offsetX!=undefined){form.clk_x=e.offsetX;form.clk_y=e.offsetY}else if(typeof $.fn.offset=='function'){var offset=$el.offset();form.clk_x=e.pageX-offset.left;form.clk_y=e.pageY-offset.top}else{form.clk_x=e.pageX-target.offsetLeft;form.clk_y=e.pageY-target.offsetTop}}setTimeout(function(){form.clk=form.clk_x=form.clk_y=null},100)})};$.fn.ajaxFormUnbind=function(){return this.unbind('submit.form-plugin click.form-plugin')};$.fn.formToArray=function(semantic){var a=[];if(this.length===0){return a}var form=this[0];var els=semantic?form.getElementsByTagName('*'):form.elements;if(!els){return a}var i,j,n,v,el,max,jmax;for(i=0,max=els.length;i<max;i++){el=els[i];n=el.name;if(!n){continue}if(semantic&&form.clk&&el.type=="image"){if(!el.disabled&&form.clk==el){a.push({name:n,value:$(el).val()});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y})}continue}v=$.fieldValue(el,true);if(v&&v.constructor==Array){for(j=0,jmax=v.length;j<jmax;j++){a.push({name:n,value:v[j]})}}else if(v!==null&&typeof v!='undefined'){a.push({name:n,value:v})}}if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0];n=input.name;if(n&&!input.disabled&&input.type=='image'){a.push({name:n,value:$input.val()});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y})}}return a};$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic))};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n){return}var v=$.fieldValue(this,successful);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++){a.push({name:n,value:v[i]})}}else if(v!==null&&typeof v!='undefined'){a.push({name:this.name,value:v})}});return $.param(a)};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];var v=$.fieldValue(el,successful);if(v===null||typeof v=='undefined'||(v.constructor==Array&&!v.length)){continue}v.constructor==Array?$.merge(val,v):val.push(v)}return val};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(successful===undefined){successful=true}if(successful&&(!n||el.disabled||t=='reset'||t=='button'||(t=='checkbox'||t=='radio')&&!el.checked||(t=='submit'||t=='image')&&el.form&&el.form.clk!=el||tag=='select'&&el.selectedIndex==-1)){return null}if(tag=='select'){var index=el.selectedIndex;if(index<0){return null}var a=[],ops=el.options;var one=(t=='select-one');var max=(one?index+1:ops.length);for(var i=(one?index:0);i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(!v){v=(op.attributes&&op.attributes['value']&&!(op.attributes['value'].specified))?op.text:op.value}if(one){return v}a.push(v)}}return a}return $(el).val()};$.fn.clearForm=function(){return this.each(function(){$('input,select,textarea',this).clearFields()})};$.fn.clearFields=$.fn.clearInputs=function(){var re=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(re.test(t)||tag=='textarea'){this.value=''}else if(t=='checkbox'||t=='radio'){this.checked=false}else if(tag=='select'){this.selectedIndex=-1}})};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=='function'||(typeof this.reset=='object'&&!this.reset.nodeType)){this.reset()}})};$.fn.enable=function(b){if(b===undefined){b=true}return this.each(function(){this.disabled=!b})};$.fn.selected=function(select){if(select===undefined){select=true}return this.each(function(){var t=this.type;if(t=='checkbox'||t=='radio'){this.checked=select}else if(this.tagName.toLowerCase()=='option'){var $sel=$(this).parent('select');if(select&&$sel[0]&&$sel[0].type=='select-one'){$sel.find('option').selected(false)}this.selected=select}})};function log(){var msg='[jquery.form] '+Array.prototype.join.call(arguments,'');if(window.console&&window.console.log){window.console.log(msg)}else if(window.opera&&window.opera.postError){window.opera.postError(msg)}}})(jQuery);(function($){$.fn.dwinAjaxForm=function(options){if($.isFunction(options.success)){var successCallback=options.success}if($.isFunction(options.error)){var errorCallback=options.error}var settings={'success':function(response,statusText,xhr,form){form.data('submitted',false);if($.isFunction(successCallback)){successCallback(response,statusText,xhr,form)}},'error':function(response,statusText,errorThrown){$('form').data('submitted',false);if($.isFunction(errorCallback)){errorCallback(response,statusText,errorThrown)}}};$.extend(options,settings);return this.ajaxForm(options)}})(jQuery);(function($a){var _tracker;$a.tierAffiliateDirectory='Affiliate Directory';$a.tierMerchantDirectory='Merchant Directory';$a.tierAffiliateProfiles='Affiliate Profiles';$a.tierMerchantProfiles='Merchant Profiles';$a.tierAccounts='Accounts';$a.tierProgrammeUpgrades='Programme Upgrades';$a.init=function(tracker){_tracker=tracker;$(document).delegate('[data-gacategory][data-gaaction]','click',function(event){var cat=$(this).attr('data-gacategory');var act=$(this).attr('data-gaaction');var lab=$(this).attr('data-galabel');if(typeof cat==='undefined'||typeof act==='undefined'){return}var link=$(this).closest('a');if(link.length){event.preventDefault();$a.trackEvent(cat,act,lab);setTimeout('document.location = "'+link.attr('href')+'"',100)}else{$a.trackEvent(cat,act,lab)}})};$a.trackEvent=function(category,action,optLabel){if(!_tracker){return}_tracker.push(['_trackEvent',category,action,optLabel])};$a.getCategory=function(type,index){if(index==undefined){index=DWIN.Account.getDetails().accountType}if(index==undefined){return}if(type=='directory'){var trackingCategories={"affiliate":$a.tierMerchantDirectory,"merchant":$a.tierAffiliateDirectory}}else if(type=='profile'){var trackingCategories={"affiliate":$a.tierMerchantProfiles,"merchant":$a.tierAffiliateProfiles}}else if(type=='joinProgramme'){var trackingCategories={"directory":$a.tierMerchantDirectory,"merchant":$a.tierMerchantProfiles}}if(trackingCategories==undefined){return}return trackingCategories[index]}})(DWIN.Analytics={});jQuery('.userMessage .remindableClose').click(function(){var that=jQuery(this),userMessage=that.parent();var host=window.location.href.match(/:\/\/(.[^/]+)/)[1];if(host==='marketplace.zanox.com'){var url='https://'+host}else{var url='https://darwin.'+host.replace(/^www\./,'').replace(/^darwin\./,'').replace(/^zanox-marketplace\./,'')}jQuery.ajax({type:'GET',url:url+'/user-message/xhr-remind-me',data:{'key':that.attr('data-usermessage-remindable-key')},dataType:'jsonp',success:function(data){userMessage.slideUp('slow')},error:function(){jQuery.alerts.alert(DWIN.i18n.t('js.userMessage.remindableClose.error'))}})});